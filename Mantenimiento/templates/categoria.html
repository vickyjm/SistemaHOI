{% extends "base-col21.html" %}
{% load templatetags %}

{% block page_menu %}
	<script>
		window.onload = function WindowLoad(event) {
	    	document.getElementById("categorias").setAttribute("class","current-page-item");
		}	/*No puedo poner el id en <li> porque class esta en <a>*/
	</script>
{% endblock page_menu%}

{% block page_title %}Categorías{% endblock page_title %}

{% block page_left %}
{% endblock page_left %}

{% block page_content %}
	{% if mensaje2 %}
		<h3 class="exito" style="text-align:center">{{mensaje2}}</h3>
	{% endif %}

	{% if categorias %}
		<table  id="rowspan" cellspacing="0" class="tablesorter categorias" style="width:100%">
			<thead>
				<th id="head1"><h3>Nombre</h3></th>
				{% if user|has_group:"Almacenistas" %}
				<th id="head2"><h3>Estado</h3></th>
				{% endif %}
				{% if user|has_group:"Administradores" %}
				<td class="head3"><h3>Editar</h3></td>
				{% endif %}
			</thead>

			<tbody>
				{% for cat in categorias %}
				<tr>
				{% if cat.estado %}
					<td class="col1"><h3 class="activo">{{ cat }}</h3></td>
					{% if user|has_group:"Almacenistas" %}
					<td class="col2"><h3 class="activo">{{ cat.get_estado_display }}</h3></td>
					{% endif %}
				{% else %}
					{% if user|has_group:"Almacenistas" %}
					<td class="col1"><h3 class="inactivo">{{ cat }}</h3></td>
					<td class="col2"><h3 class="inactivo">{{ cat.get_estado_display }}</h3></td>
					{% endif %}
				{% endif %}
					{% if user|has_group:"Administradores" %}
					<td class="col3"><a href="{% url 'categoria_editar' cat.id %}"><i class="fa fa-pencil-square-o"></i></a></td>
					{% endif %}
				</tr>
				{% endfor %}
			</tbody>
		</table>
		<script src="{{ STATIC_URL }}js/setHeaderWidth.js"></script>
		<script>
			var totals = new Array();

			var table = document.getElementById("rowspan");
			var rows = table.getElementsByTagName('tr');
			for (var i = 0 ; i < rows.length ; i++){
				totals.push(rows[i].getElementsByTagName('td').length);
			}

			cellCount = 0;
			for (var i = 0 ; i < totals.length ; i++) {
				if (totals[i] > 0){
					cellCount = totals[i];
				}
			}
			var head1 = document.getElementById('head1');			
			var head2 = document.getElementById('head2');
			var head3 = document.getElementById('head3');
			var tdsCol1 = document.getElementsByClassName('col1');
			var tdsCol2 = document.getElementsByClassName('col2');
			var tdsCol3 = document.getElementsByClassName('col3');
			var i;

			if (cellCount == 1) {
				head1.style.width = "735px";
				for (i = 0; tdsCol1.length; i++){
					tdsCol1[i].style.width = "735px";
				}
		    } else if (cellCount == 2) {
				head1.style.width = "535px";
				head2.style.width = "200px";
				for (i = 0; tdsCol1.length; i++){
					tdsCol1[i].style.width = "535px";
					tdsCol2[i].style.width = "200px";
				}
		    } else {
		    	head1.style.width = "535px";
				head2.style.width = "100px";
				head3.style.width = "100px";
		    	for (i = 0; tdsCol1.length; i++){
					tdsCol1[i].style.width = "535px";
					tdsCol2[i].style.width = "100px";
					tdsCol2[i].style.width = "100px";
				}
		    }
		    var $table = $('table.tablesorter'),
		    $bodyCells = $table.find('tbody tr:first').children(),
		    colWidth;
		    colWidth = $bodyCells.map(function() {
		        return $(this).width();
		    }).get();
		    
		    $table.find('thead tr').children().each(function(i, v) {
		        $(v).width(colWidth[i]+10);
		    });    
		</script>



	{% else %}
		<h3>No hay categorías registradas.</h3>
	{% endif %}
{% endblock page_content %}

{% block page_right %}
<form action="{% url 'categorias' %}" method="post" id="form">

{% if user|has_group:"Administradores" %}
	<h2>Crear categoría</h2>
	<table style="width:100%" >
		<thead>
		</thead>
		{% csrf_token %}
		<tbody>
			{% if mensaje %}
				<h3 style={{color | safe}}>{{mensaje}}</h3>
			{% endif %}
			
			{% for field in form %}
				<h3>{{field.label_tag}}</h3>
				<h4 class="error">{{ field.errors}}</h4>
				{{field}}<br><br>
			{% endfor %}

			<tr>
				<td align="right"><br><br>
				<!-- <input type="submit" class="button" value="Crear categoría"> -->
				<a href="#" onClick=document.getElementById("form").submit() class="button" align = "right"><i class="fa fa-plus-square"></i>     Crear categoría</a>
				</td>
			</tr>
		</tbody>
	</table>
{% endif %}

</form>
{% endblock page_right %}