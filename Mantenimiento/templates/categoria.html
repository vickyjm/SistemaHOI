{% extends "base-col21.html" %}
{% load templatetags %}

{% block page_menu %}
	<script>
		window.onload = function WindowLoad(event) {
	    	document.getElementById("categorias").setAttribute("class","current-page-item");
		}	/*No puedo poner el id en <li> porque class esta en <a>*/
	</script>
{% endblock page_menu%}

{% block page_title %}Categorías{% endblock page_title %}

{% block page_left %}
{% endblock page_left %}

{% block page_content %}
	{% if mensaje2 %}
		<h3 class="exito" style="text-align:center">{{mensaje2}}</h3>
	{% endif %}

	{% if categorias %}
		<table  id="rowspan" cellspacing="0" class="tablesorter categorias" style="width:100%">
			<thead>
				<th><h3>Nombre</h3></th>
				{% if user|has_group:"Almacenistas" %}
				<th><h3>Estado</h3></th>
				{% endif %}
				{% if user|has_group:"Administradores" %}
				<td><h3>Editar</h3></td>
				{% endif %}
			</thead>

			<tbody>
				{% for cat in categorias %}
				<tr>
				{% if cat.estado %}
					<td class="col1"><h3 class="activo">{{ cat }}</h3></td>
					{% if user|has_group:"Almacenistas" %}
					<td class="col2"><h3 class="activo">{{ cat.get_estado_display }}</h3></td>
					{% endif %}
				{% else %}
					{% if user|has_group:"Almacenistas" %}
					<td class="col1"><h3 class="inactivo">{{ cat }}</h3></td>
					<td class="col2"><h3 class="inactivo">{{ cat.get_estado_display }}</h3></td>
					{% endif %}
				{% endif %}
					{% if user|has_group:"Administradores" %}
					<td class="col3"><a href="{% url 'categoria_editar' cat.id %}"><i class="fa fa-pencil-square-o"></i></a></td>
					{% endif %}
				</tr>
				{% endfor %}
			</tbody>
		</table>

		<script>
			var totals = new Array();

			var table = document.getElementById("rowspan");
			var rows = table.getElementsByTagName('tr');
			for (var i = 0 ; i < rows.length ; i++){
				totals.push(rows[i].getElementsByTagName('td').length);
			}

			cellCount = 0;
			for (var i = 0 ; i < totals.length ; i++) {
				if (totals[i] > 0){
					cellCount = totals[i];
				}
			}
			if (cellCount == 1) {
/*		    	document.getElementById("col1").style.background = "blue";*/

				var x = document.getElementsByTagName('td');
				var i;
				for (i = 0; i < x.length; i++){
/*					x[i].style.backgroundColor= "red";*/
					x[i].style.width = "753px";
				}
		    }
		</script>

		<script src="{{ STATIC_URL }}js/setHeaderWidth.js"></script>

	{% else %}
		<h3>No hay categorías registradas.</h3>
	{% endif %}
{% endblock page_content %}

{% block page_right %}
<form action="{% url 'categorias' %}" method="post" id="form">

{% if user|has_group:"Administradores" %}
	<h2>Crear categoría</h2>
	<table style="width:100%" >
		<thead>
		</thead>
		{% csrf_token %}
		<tbody>
			{% if mensaje %}
				<h3 style={{color | safe}}>{{mensaje}}</h3>
			{% endif %}
			
			{% for field in form %}
				<h3>{{field.label_tag}}</h3>
				<h4 class="error">{{ field.errors}}</h4>
				{{field}}<br><br>
			{% endfor %}

			<tr>
				<td align="right"><br><br>
				<!-- <input type="submit" class="button" value="Crear categoría"> -->
				<a href="#" onClick=document.getElementById("form").submit() class="button" align = "right"><i class="fa fa-plus-square"></i>     Crear categoría</a>
				</td>
			</tr>
		</tbody>
	</table>
{% endif %}

</form>
{% endblock page_right %}