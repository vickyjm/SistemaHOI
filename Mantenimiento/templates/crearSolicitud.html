{% extends "base-col3.html" %}
{% load templatetags %}

{% block page_menu %}
	<a href="./verperfil">Perfil</a>
	<a href="./solicitud">Solicitudes</a>
	<a href="./inventario">Inventario</a>
	<a href="./categorias" >Categor√≠as</a>
{% endblock page_menu%}

{% block page_title %}Crear Solicitud{% endblock page_title %}
{% block page_left %}{% endblock page_left %}
{% block page_content %}

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

<form action="" method="get" accept-charset="utf-8">
	
	<select name="categoria" id="categoria">
        <option value="">*CATEGORIAS*</option>
		{% lista_categorias %}
    </select>


    <select name="item" id="item" disabled = "true">
        <option>---------</option>
    </select>
</form>


<script>
    $(function() {
        $("select#categoria").change(function() {
            if ($(this).val() == "") {
                $("select#item").html("<option>---------</option>");
                $("select#item").attr('disabled', true);
            }
            else {
                var cat_nombre = $(this).find('option:selected').val();
                var url = "/categoria/" + cat_nombre + "/all_json_items";
                
                $.getJSON(url, function(items) {
                    var options = '<option value="" selected="selected">---------</option>';
                    for (var i = 0; i < items.length; i++) {
                		options += '<option value="' + items[i].pk + '">' + items[i].fields['nombre'] + '</option>';
             		}
                    //$.each(items, function(k,v){
    				//	var option = "<option value="+k+">";
    				//	option += v;
    				//	option += "</option>";
    				//	options += option
    				//});
                    $("select#item").html(options);
                    $("select#item option:first").attr('selected', 'selected');
                    $("select#item").attr('disabled', false);
                });
            }
        });


        $("select#item").change(function(vent) {
            if ($(this).val() == -1) {
                return;
            }
        });
    });
</script>



<form action="" method="post">

	<table style="width:100%" >
		<thead>
		</thead>
		{% csrf_token %}
		<tbody>
			{% if mensaje %}
				<h3 style="color:green">{{mensaje}}</h3>
			{% endif %}
			{% for field in form %}

			 <h3>{{field.label_tag}}</h3>
			 <h4 style = "color:#CC0000">{{ field.errors}}</h4>
			 {{field}}<br><br>

			 {% endfor %}
		 <tr>
			<td align="right"><br><br>
			<input type="submit" class="button" value="Crear solicitud"></td>
		</tr>
		</tbody>
	</table>
</form>
{% endblock page_content %}
{% block page_right %}{% endblock page_right %}